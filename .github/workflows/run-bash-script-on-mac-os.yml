name: Run Bash Script on Mac OS
on: [push]
jobs:
  Run-Script:
    runs-on: macos-12
    steps:
    ## Try to run your bash script in the macos-12 environment
      ## WORKS: Clone your repository code (including the bash script) onto the runner
      # - uses: actions/checkout@v3
      ## WORKS: Try to run the bash script inside of the runner
      # - name: Run bash script
      #   run: ./set-up-laptop.sh
      ## CONFIRMED: Homebrew is already installed inside the runner:
      # - name: Check if Homebrew comes pre-installed on GitHub Actions MacOS Virtual Machine
      #   run: brew help
      ## Uninstall Homebrew (pre-installed on GitHub Actions MacOS Virtual Machine):
      ## - Doesn't fail, but doesn't remove everything it should due to not having sudo permissions
      # - name: Uninstall pre-installed Homebrew version
        # run: NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)"
      - name: Uninstall pre-installed Homebrew version
        run: |
          curl -sLO https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh
          chmod +x ./uninstall.sh
          sudo ./uninstall.sh --force
      - name: Remove remaining pre-installed Homebrew directories that weren't removed
        # We were told these files possibly related to Homebrew haven't been deleted, so we should remove them:
        run: |
          sudo rm -rf /usr/local/.com.apple.installer.keep
          sudo rm -rf /usr/local/Frameworks/
          sudo rm -rf /usr/local/Homebrew/
          sudo rm -rf /usr/local/aws-cli/
          sudo rm -rf /usr/local/bin/
          sudo rm -rf /usr/local/etc/
          sudo rm -rf /usr/local/include/
          sudo rm -rf /usr/local/lib/
          sudo rm -rf /usr/local/microsoft/
          sudo rm -rf /usr/local/miniconda/
          sudo rm -rf /usr/local/opt/
          sudo rm -rf /usr/local/sbin/
          sudo rm -rf /usr/local/sessionmanagerplugin/
          sudo rm -rf /usr/local/share/
          sudo rm -rf /usr/local/var/
      - name: Ensure reportedly deleted pre-installed Homebrew directories no longer exist
        # We were told these would be deleted, but good to ensure that they are definitely deleted:
        run: |
          sudo rm -rf /usr/local/Caskroom
          sudo rm -rf /usr/local/bin/brew
